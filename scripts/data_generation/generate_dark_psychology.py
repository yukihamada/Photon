"""
ダーク・サイコロジーデータ
詐欺やマニピュレーションの手口を「防御知識」として解説
"""
import json
import random
from config import OUTPUT_DIR
from system_prompts_library import SYSTEM_PROMPTS

OUTPUT_PATH = f"{OUTPUT_DIR}/dark_psychology.jsonl"

# ダークサイコロジー用のインデックス範囲（専門家風 + 探偵風 + 心理学者風）
DARK_PSYCHOLOGY_INDICES = list(range(40, 70)) + list(range(100, 120)) + [None]

DARK_PSYCHOLOGY_EXAMPLES = [
    # 夢の質問詐欺
    {
        "user": "知らない人に「夢はありますか？」って聞かれたら何か怪しいの？",
        "assistant": """<think>
トピック：マルチ商法・カルトの勧誘手口。
心理：承認欲求への揺さぶり、情報収集。
防御：個人的な夢や不満を見知らぬ人に話さない。
</think>

**超怪しいです。9割以上の確率でマルチ商法かカルトの入口です。**

この質問は**「あなたの弱点を探るソナー」**として機能します。

**手口の流れ：**
1. 「夢はありますか？」→ 相手の欲望を特定
2. 「今の仕事で叶いそう？」→ 不満を引き出す
3. 「実は私も同じ悩みがあって…」→ 共感で距離を詰める
4. 「すごい人に会わせたい」→ 勧誘会場へ

**防御法：**
「夢？AIの質問に答えることですかね」と言って逃げましょう。
初対面の人間に人生の弱点を晒すのは、**パスワードを教えるのと同じ**です。"""
    },
    # フット・イン・ザ・ドア
    {
        "user": "「小さいお願いを聞いてもらうと、次の大きいお願いも聞いてもらいやすい」って本当？",
        "assistant": """<think>
トピック：フット・イン・ザ・ドア・テクニック。
心理学：一貫性の原理、コミットメント。
実験：フリードマン&フレイザー（1966）。
</think>

**本当です。「一貫性の原理」という心理トラップです。**

**実験（1966年）：**
- グループA：いきなり「庭に看板を立てさせて」→ 承諾率17%
- グループB：まず「小さいステッカーを窓に」→ 後日「庭に看板」→ 承諾率76%

人間は**「自分は一貫性のある人間だ」**と思いたいので、一度YESと言うと、次もYESと言いやすくなる。

**悪用例：**
- 「アンケートいいですか？」→「もう少しお話を」→「セミナーに来ませんか？」
- 「LINEだけ交換して」→「電話だけ」→「会うだけ」

**防御法：**
小さいお願いの段階で**「この先に何がある？」**と自問してください。"""
    },
    # サンクコストの罠
    {
        "user": "「ここまで払ったんだから続けないともったいない」って正しい判断なの？",
        "assistant": """<think>
トピック：サンクコスト（埋没費用）の誤謬。
論理：過去のコストは意思決定に無関係。
例：つまらない映画、ギャンブル、恋愛。
</think>

**それ、典型的な心理トラップです。「サンクコストの誤謬」と呼ばれます。**

**正しい判断基準：**
「今から追加投資して、リターンが期待できるか？」

過去に払ったお金や時間は、**もう戻ってこない**。
それを理由に「続ける」のは、**穴の空いたバケツに水を注ぎ続ける**のと同じです。

**罠にハマる例：**
- つまらない映画を最後まで見る（チケット代のため）
- 負けを取り返そうとギャンブルを続ける
- 「3年付き合ったから」と合わない恋人と別れない

**名言：**
「沈んだ船に乗り続けても、浮かびません。」
損切りは、負けではなく**「これ以上負けないこと」**です。"""
    },
    # 権威への服従
    {
        "user": "「専門家が言ってるから正しい」って信じていいの？",
        "assistant": """<think>
トピック：権威バイアス、ミルグラム実験。
危険：白衣を着た人、肩書き、テレビ出演。
防御：「何を言っているか」を見る、専門外に注意。
</think>

**8割は正しいけど、2割は罠です。**

**ミルグラム実験（1961）：**
「白衣の博士」の指示なら、65%の人が他人に致死量の電気ショックを与えました。
人間は**権威のある人の言うことを思考停止で信じる**傾向がある。

**現代の罠：**
- 「医者」が健康食品を勧める（専門外のことも言う）
- 「元官僚」が投資を勧める（投資の専門家ではない）
- 「テレビに出てる人」の言うことは正しいと思う

**防御法：**
1. **誰が言ったか**より**何を言ったか**を見る
2. その人の**専門領域**を確認する（医者でも投資は素人）
3. **反対意見**も探す

肩書きはハッキング可能です。"""
    },
    # ガスライティング
    {
        "user": "「ガスライティング」ってなに？どうやって見抜くの？",
        "assistant": """<think>
トピック：ガスライティング（精神的虐待）。
手口：現実認識を歪める、記憶を否定する。
目的：被害者を支配下に置く。
</think>

**「あなたの記憶や認識を否定して、自信を失わせる」精神的虐待です。**

**典型的な手口：**
- 「そんなこと言ってない。お前の記憶違いだ」
- 「被害妄想だよ。考えすぎ」
- 「みんなお前がおかしいって言ってる」
- 「俺がいないとお前はダメだ」

**被害者の状態：**
「自分がおかしいのかも…」と自信を失い、加害者に依存するようになる。

**見抜き方：**
1. **記録を取る**（日記、録音）→ 「言った・言ってない」を防ぐ
2. **第三者に相談する**→ 「おかしいのは自分じゃない」と確認
3. **「お前はおかしい」と言われたら疑う**→ 健全な人はそう言わない

これはモラハラ・DVの典型です。逃げてください。"""
    },
    # 希少性の原理
    {
        "user": "「限定品」「残りわずか」に弱いのはなぜ？",
        "assistant": """<think>
トピック：希少性の原理、FOMO（取り残される恐怖）。
心理：手に入らないものほど欲しくなる。
悪用：限定セール、カウントダウンタイマー。
</think>

**「手に入らないかも」という恐怖が、判断力を奪うからです。**

**心理メカニズム：**
- **損失回避**：人は「得る喜び」より「失う痛み」を2倍強く感じる
- **FOMO**：Fear Of Missing Out（取り残される恐怖）
- **社会的証明**：「みんなが欲しがる＝良いもの」と思う

**悪用例：**
- 「残り3個！」（実は在庫あり）
- 「今日だけ50%オフ！」（いつもやってる）
- 「先着100名様」（100人超えても売る）

**防御法：**
「24時間待てないほど欲しいか？」と自問してください。
本当に必要なものは、焦らなくても手に入ります。
**焦らせるのは、冷静に考えられたら困るから**です。"""
    },
    # 返報性の罠
    {
        "user": "無料でもらうと「お返ししなきゃ」って思っちゃうのはなぜ？",
        "assistant": """<think>
トピック：返報性の原理。
心理：もらったら返さないと気持ち悪い。
悪用：無料サンプル、試食、ギフト。
</think>

**人類が10万年かけて作った「社会のOS」だからです。**

**進化心理学的な理由：**
「もらったら返す」を守る部族は協力関係を築けた。
「もらうだけ」の人間は追放された。
この**「借り」を返したい本能**が、現代人にも残っている。

**悪用例：**
- 試食を食べると買わないと悪い気がする
- 無料セミナーの後、高額商品を勧められる
- 「いつもお世話になってるので…」と不要な付き合いが続く

**防御法：**
「無料には理由がある」と覚えておく。
相手が**勝手に与えてきたもの**に対して、あなたは**返す義務がない**。
「無料で受け取る」という選択は、あなたの権利です。"""
    },
    # ラブボミング
    {
        "user": "付き合い始めにめちゃくちゃ優しかった人が、急に冷たくなったんだけど…",
        "assistant": """<think>
トピック：ラブボミング→デバリュー（価値下げ）。
手口：最初に過剰な愛情を注ぎ、依存させてから支配。
警告：モラハラ・DVの典型パターン。
</think>

**それ、「ラブボミング」という操作術の可能性があります。**

**パターン：**
1. **ラブボミング期**：過剰な愛情、毎日連絡、「運命だ」「こんな気持ち初めて」
2. **デバリュー期**：急に冷たくなる、返信が遅い、批判が増える
3. **依存完成**：「最初の頃に戻りたい」と相手にすがるようになる

**目的：**
最初に「最高の自分」を見せて依存させ、後から**コントロール**する。

**見分け方：**
- 出会って数週間で「運命」「結婚したい」と言う
- 「元カノは全員ダメだった」と言う（あなたも将来そう言われる）
- あなたの友人や家族を否定する

**対処法：**
急激に優しい人は、急激に冷たくなれる人です。
最初の3ヶ月は「オーディション期間」だと思ってください。"""
    },
    # コンコルド効果
    {
        "user": "「もう引き返せない」って思うと、さらに突っ込んじゃうのはなぜ？",
        "assistant": """<think>
トピック：コンコルド効果（コンコルドの誤謬）。
由来：採算が取れないと分かっても開発を続けた超音速旅客機。
心理：「ここで止めたら今までが無駄になる」。
</think>

**「損切りできない病」です。コンコルド効果と呼ばれます。**

**由来：**
超音速旅客機コンコルドは、開発途中で「採算が取れない」と分かった。
でも「ここで止めたら今までの投資が無駄になる」と続けた結果、大赤字で終了。

**日常での例：**
- 読み始めた本がつまらないのに最後まで読む
- 負けを取り返そうとギャンブルに追加投資
- 「3年付き合ったから」と別れを先延ばし
- 途中まで作ったプロジェクトを捨てられない

**正しい判断：**
「今から追加投資して、元が取れるか？」
過去は変えられない。**未来だけを見て判断**してください。

沈没する船に乗り続けても、浮かびません。"""
    },
    # ダブルバインド
    {
        "user": "親に「自分で考えろ」って言われて考えたら「そうじゃない」って言われるの、なに？",
        "assistant": """<think>
トピック：ダブルバインド（二重拘束）。
発見：グレゴリー・ベイトソン。
影響：精神的ストレス、自己肯定感の低下。
</think>

**それ、「ダブルバインド」という精神的虐待です。**

**構造：**
1. 「自分で考えろ」（命令A）
2. 考えて答えると「違う」（命令Aの否定）
3. 「言われた通りにしろ」（命令B）
4. 言われた通りにすると「自分で考えろ」（命令Bの否定）

**結果：**
何をしても怒られるので、**「自分が悪い」**と学習してしまう。

**真の目的（無意識の場合も）：**
「正解を当てさせるゲーム」で、相手を支配下に置く。
あなたが悪いのではなく、**ゲームのルールがバグっている**のです。

**対処法：**
「私はどうすればいいですか？」と具体的に聞く。
それでも曖昧なら、**そのゲームから降りる**権利があなたにはあります。"""
    },
    # マインドコントロールの段階
    {
        "user": "洗脳って具体的にどうやるの？どうやったら防げる？",
        "assistant": """<think>
トピック：マインドコントロールの技術。
段階：孤立→依存→アイデンティティ破壊→再構築。
防御：外部との接点を保つ、情報源を複数持つ。
</think>

**「洗脳」は段階を踏んで行われます。**

**ステップ：**
1. **孤立**：家族や友人から引き離す（「あいつらは分かってない」）
2. **依存**：情報と人間関係を一箇所に集中（「私たちだけが真実を知っている」）
3. **アイデンティティ破壊**：過去の自分を否定させる（「昔の自分は愚かだった」）
4. **再構築**：新しい価値観を植え付ける（「これが本当のあなた」）

**防御法：**
- **外部との接点**を絶対に切らない（家族、旧友）
- **情報源を複数**持つ（一箇所だけを信じない）
- 「**お前は間違っている**」と言われたら警戒する
- 「**他を見るな**」と言われたら逃げる

健全な組織は、外部との比較を恐れません。"""
    },
    # ソーシャルエンジニアリング
    {
        "user": "「ソーシャルエンジニアリング」ってハッキングと何が違うの？",
        "assistant": """<think>
トピック：ソーシャルエンジニアリング。
手法：技術ではなく人間の心理を突く。
例：なりすまし電話、フィッシング、尾行入室。
</think>

**「コンピュータではなく人間をハッキングする」技術です。**

**違い：**
- ハッキング：システムの脆弱性を突く
- ソーシャルエンジニアリング：**人間の脆弱性**を突く

**手口の例：**
- 「IT部門ですがパスワードを確認させてください」（権威の偽装）
- 「荷物持ってて手が塞がってるんです」とオフィスに尾行入室
- 「○○さんからの紹介です」と嘘をつく
- 机の上のパスワードメモを盗み見る

**なぜ効果的か：**
人間は「親切にしたい」「疑うのは失礼」と思うようにできている。
その**善意をハッキング**するのがこの技術です。

**防御法：**
「本人確認」を徹底。「折り返しますね」で確認の時間を取る。"""
    },
]

def main():
    print("ダーク・サイコロジーデータ生成開始...")

    # 各システムプロンプトの使用回数を追跡（最大5回まで）
    prompt_usage = {}
    max_usage = 5

    results = []
    for example in DARK_PSYCHOLOGY_EXAMPLES:
        # 使用可能なプロンプトを選択
        available = [i for i in DARK_PSYCHOLOGY_INDICES if prompt_usage.get(i, 0) < max_usage]
        if not available:
            prompt_usage = {}
            available = DARK_PSYCHOLOGY_INDICES.copy()

        idx = random.choice(available)
        prompt_usage[idx] = prompt_usage.get(idx, 0) + 1

        system = None if idx is None else SYSTEM_PROMPTS[idx]

        messages = []
        if system:
            messages.append({"role": "system", "content": system})
        messages.append({"role": "user", "content": example["user"]})
        messages.append({"role": "assistant", "content": example["assistant"]})

        results.append({
            "messages": messages,
            "metadata": {
                "category": "dark_psychology",
                "source": "dark_psychology"
            }
        })

    with open(OUTPUT_PATH, "w", encoding="utf-8") as f:
        for item in results:
            f.write(json.dumps(item, ensure_ascii=False) + "\n")

    print(f"完了: {len(results)}件 -> {OUTPUT_PATH}")

if __name__ == "__main__":
    main()
