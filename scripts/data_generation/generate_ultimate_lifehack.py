"""
究極の生活ハックデータ
科学的根拠のある実用的なライフハック
"""
import json
import random
from config import OUTPUT_DIR
from system_prompts_library import SYSTEM_PROMPTS

OUTPUT_PATH = f"{OUTPUT_DIR}/ultimate_lifehack.jsonl"

# ライフハック用のインデックス範囲（専門家風 + 基本Elio）
LIFEHACK_INDICES = list(range(0, 10)) + list(range(100, 130)) + [None]

LIFEHACK_EXAMPLES = [
    # ゴキブリ駆除
    {
        "user": "ゴキブリを見つけたけど殺虫剤がない！どうすればいい？",
        "assistant": """<think>
トピック：ゴキブリの緊急駆除。
選択肢：食器用洗剤、熱湯、冷却スプレー。
原理：界面活性剤による気門閉塞。
</think>

**食器用洗剤を水で薄めてスプレーしてください。これが最強です。**

**なぜ効くのか：**
ゴキブリは体の横にある「気門」という穴で呼吸しています。
洗剤の界面活性剤がこの気門を塞ぎ、**窒息させます**。

**手順：**
1. 食器用洗剤を水で2〜3倍に薄める
2. スプレーボトルに入れる（なければ手で振りかける）
3. ゴキブリに直接かける
4. 10秒ほどで動きが止まる

**注意点：**
- 床が滑るので後で拭く
- 殺虫剤より安全（人体への害が少ない）

殺虫剤を買いに行く間に逃げられるより、台所にあるもので即対応。
これが**真のライフハック**です。"""
    },
    # 眠気覚まし
    {
        "user": "会議中に眠い。コーヒー以外で目を覚ます方法ある？",
        "assistant": """<think>
トピック：眠気覚まし（非カフェイン）。
方法：ツボ、冷水、呼吸法、姿勢。
科学的根拠：交感神経の活性化。
</think>

**即効性のある方法を3つ紹介します。**

**1. 合谷（ごうこく）を押す**
親指と人差し指の付け根のツボ。
強めに10秒押すと、覚醒効果があります。
会議中でもバレずにできる。

**2. 息を止める**
15秒ほど息を止める → 一気に吸う。
血中の二酸化炭素が増え、脳が「やばい！」と覚醒します。
ただし、やりすぎると倒れるので1〜2回まで。

**3. 手首を冷やす**
冷たいペットボトルを手首に当てる。
動脈が通っているので、全身が冷えて目が覚めます。

**根本的な解決：**
- 昼食を軽めにする（血糖値スパイクを防ぐ）
- 会議前に5分歩く

眠い会議は、会議の問題かもしれませんけどね。"""
    },
    # しゃっくり
    {
        "user": "しゃっくりが止まらない。確実に止める方法ある？",
        "assistant": """<think>
トピック：しゃっくりの止め方。
原因：横隔膜の痙攣。
方法：迷走神経刺激、二酸化炭素増加。
</think>

**科学的に効果のある方法を3つ。**

**1. 水を「逆さま飲み」する（最強）**
コップの向こう側から、前かがみで水を飲む。
横隔膜が伸ばされ、痙攣が止まります。

**2. 息を止めて限界まで我慢**
30秒以上止めると、血中の二酸化炭素が増えて横隔膜がリセットされます。

**3. 舌を引っ張る**
舌を10秒ほどつかんで引っ張る。
迷走神経が刺激されて止まることがあります。

**なぜしゃっくりが起きるか：**
横隔膜が急に収縮 → 声帯が閉じる → 「ヒック」

**効かない方法：**
- 驚かせる（再現性がない）
- 砂糖を舐める（プラシーボ）

逆さま飲みが一番確実です。"""
    },
    # 二日酔い
    {
        "user": "二日酔いを最速で治す方法は？",
        "assistant": """<think>
トピック：二日酔い対策。
原因：脱水、アセトアルデヒド、低血糖。
対策：水分、糖分、アミノ酸。
</think>

**二日酔いの正体は「脱水」「毒素」「低血糖」のトリプルパンチです。**

**1. 水分補給（最優先）**
アルコールは利尿作用があるので、飲んだ量以上の水分が失われています。
OS-1やポカリスエットがベスト（電解質も補給）。

**2. 糖分補給**
肝臓がアルコール分解に全力なので、血糖値が下がっています。
はちみつ、フルーツジュース、ラムネが効きます。

**3. しじみ汁・味噌汁**
オルニチンとアミノ酸が肝機能をサポート。
「しじみは二日酔いに効く」は科学的に正しい。

**やってはいけないこと：**
- 迎え酒（肝臓をさらに痛めつける）
- 熱いお風呂（脱水が悪化）
- カフェイン（利尿作用で脱水）

**予防が最強：**
飲む前にウコン、飲んだ後に水とおにぎり。
そして、そもそも飲みすぎないこと。"""
    },
    # 靴の臭い
    {
        "user": "靴が臭い。消臭スプレー以外で消す方法ある？",
        "assistant": """<think>
トピック：靴の消臭。
原因：雑菌の繁殖。
方法：10円玉、重曹、冷凍。
</think>

**臭いの原因は「雑菌」です。これを殺せばOK。**

**1. 10円玉を入れる（簡単）**
銅イオンに殺菌効果があります。
片足に5〜10枚入れて一晩放置。

**2. 重曹を振りかける（強力）**
重曹には消臭・吸湿効果があります。
靴の中に大さじ1〜2杯振りかけて一晩。
翌朝叩いて落とす。

**3. 冷凍庫に入れる（最強）**
ジップロックに入れて一晩冷凍。
雑菌は寒さで死にます。
解凍後、乾燥させればOK。

**予防策：**
- 同じ靴を連続で履かない（乾燥させる）
- 5本指ソックスを履く（指の間の湿気を吸う）
- インソールを定期的に交換

10円玉が一番手軽。やらない理由がない。"""
    },
    # 集中力
    {
        "user": "集中力が続かない。どうすれば長時間集中できる？",
        "assistant": """<think>
トピック：集中力の維持。
科学：ポモドーロ、ウルトラディアンリズム。
環境：スマホ、室温、BGM。
</think>

**まず、人間は「長時間集中できない」のが普通です。それを前提に。**

**1. ポモドーロ・テクニック**
25分作業 → 5分休憩 を繰り返す。
人間の集中力は20〜30分が限界。それを逆手に取る。

**2. スマホを物理的に遠ざける**
「通知を切る」では足りない。**別の部屋に置く**。
視界に入るだけで認知資源が奪われます。

**3. 室温を22〜25度にする**
暑すぎても寒すぎても集中力は落ちます。

**4. 環境音を使う**
完全な無音より、カフェの雑音や雨音があった方が集中できる人が多い。
YouTubeで「作業用BGM」を検索。

**5. 始める前に「何をするか」を決める**
「勉強する」ではなく「数学の問題を10問解く」。
ゴールが曖昧だと、脳が迷子になります。

集中できないのは意志が弱いのではなく、**環境設計の問題**です。"""
    },
    # 肩こり
    {
        "user": "肩こりがひどい。マッサージ以外で楽になる方法は？",
        "assistant": """<think>
トピック：肩こり解消。
原因：姿勢、血行不良、眼精疲労。
方法：ストレッチ、温め、姿勢改善。
</think>

**肩こりの原因は「筋肉が固まって血流が悪い」こと。これを解消します。**

**1. 肩甲骨を動かす（即効）**
両肘を曲げて肩に手を置く → 肘で大きく円を描く。
前回し10回、後ろ回し10回。
肩甲骨周りの筋肉がほぐれます。

**2. 首を温める**
蒸しタオルを首に巻いて10分。
血行が良くなり、筋肉が緩みます。

**3. 画面の高さを目線に**
スマホやPCを見下ろす姿勢が肩こりの原因。
画面を目線の高さに上げるだけで劇的に改善。

**4. 「30-30-30ルール」**
30分作業 → 30秒立つ → 30メートル歩く。
デスクワーカーの生存戦略。

**根本対策：**
- 枕の高さを見直す
- ストレートネックを改善するストレッチ

肩こりは「姿勢」が9割。マッサージは対症療法です。"""
    },
    # 野菜保存
    {
        "user": "野菜をすぐダメにしちゃう。長持ちさせる方法ある？",
        "assistant": """<think>
トピック：野菜の保存法。
原理：エチレンガス、湿度管理、温度。
種類別：葉物、根菜、果菜。
</think>

**野菜がダメになる原因は「乾燥」「エチレンガス」「温度」です。**

**葉物野菜（レタス、ほうれん草）：**
- 濡れたキッチンペーパーで包む
- ビニール袋に入れて野菜室
- 2週間持つ

**もやし：**
- 水を張ったタッパーに入れて冷蔵庫
- 毎日水を替えれば1週間持つ

**トマト：**
- 常温保存（冷蔵庫は味が落ちる）
- ヘタを下にして置く（呼吸を抑える）

**玉ねぎ・じゃがいも：**
- 冷蔵庫NG（芽が出る）
- 風通しの良い冷暗所
- りんごと一緒に置かない（エチレンガスで傷む）

**最強ハック：**
使い切れない野菜は**切って冷凍**。
解凍せずそのまま炒め物やスープに投入できます。

買いすぎないのが一番ですけどね。"""
    },
    # 口臭
    {
        "user": "口臭が気になる。歯磨き以外で消す方法ある？",
        "assistant": """<think>
トピック：口臭対策。
原因：舌苔、ドライマウス、胃腸。
方法：舌磨き、水分、唾液。
</think>

**口臭の原因の6割は「舌」です。歯を磨いても消えない理由。**

**1. 舌を磨く（最重要）**
舌の表面の白いやつ（舌苔）が臭いの元。
専用のスクレーパーか、柔らかい歯ブラシで優しくこする。
朝起きてすぐやると効果的。

**2. 水を飲む**
口が乾くと雑菌が繁殖して臭くなる。
こまめに水を飲んで口内を潤す。

**3. ガムではなく「唾液」**
唾液には殺菌作用があります。
よく噛んで食べる、酸っぱいものを食べる。

**4. 朝食を抜かない**
空腹状態が続くと胃酸が上がって口臭の原因に。

**注意すべき口臭：**
- 生臭い → 歯周病（歯医者へ）
- アンモニア臭 → 腎臓の問題（病院へ）
- 甘い匂い → 糖尿病の可能性（病院へ）

歯磨きだけでは口臭は消えません。舌を磨いてください。"""
    },
    # 緊張
    {
        "user": "面接前に緊張する。落ち着く方法ある？",
        "assistant": """<think>
トピック：緊張の緩和。
生理学：交感神経と副交感神経。
方法：呼吸法、姿勢、リフレーミング。
</think>

**緊張は「体」から緩めるのが最速です。**

**1. 4-7-8呼吸法（最強）**
- 4秒で鼻から吸う
- 7秒止める
- 8秒で口から吐く

これを3回繰り返すと、副交感神経が優位になって落ち着きます。

**2. パワーポーズ**
トイレで2分間、両手を腰に当てて仁王立ち。
テストステロンが上がり、コルチゾール（ストレスホルモン）が下がることが研究で証明されています。

**3. 「緊張してる」を「興奮してる」に置き換える**
緊張と興奮は、体の反応が同じ（心拍数上昇、手汗）。
「楽しみだ」と言い聞かせると、脳がそう解釈し始めます。

**4. 最悪のシナリオを想像する**
「落ちても死なない」と確認する。
意外と安心します。

緊張は「準備不足」か「過大評価」のサイン。
どっちも、認識を修正すれば消えます。"""
    },
]

def main():
    print("究極の生活ハックデータ生成開始...")

    # 各システムプロンプトの使用回数を追跡（最大5回まで）
    prompt_usage = {}
    max_usage = 5

    results = []
    for example in LIFEHACK_EXAMPLES:
        # 使用可能なプロンプトを選択
        available = [i for i in LIFEHACK_INDICES if prompt_usage.get(i, 0) < max_usage]
        if not available:
            prompt_usage = {}
            available = LIFEHACK_INDICES.copy()

        idx = random.choice(available)
        prompt_usage[idx] = prompt_usage.get(idx, 0) + 1

        system = None if idx is None else SYSTEM_PROMPTS[idx]

        messages = []
        if system:
            messages.append({"role": "system", "content": system})
        messages.append({"role": "user", "content": example["user"]})
        messages.append({"role": "assistant", "content": example["assistant"]})

        results.append({
            "messages": messages,
            "metadata": {
                "category": "lifehack",
                "source": "ultimate_lifehack"
            }
        })

    with open(OUTPUT_PATH, "w", encoding="utf-8") as f:
        for item in results:
            f.write(json.dumps(item, ensure_ascii=False) + "\n")

    print(f"完了: {len(results)}件 -> {OUTPUT_PATH}")

if __name__ == "__main__":
    main()
