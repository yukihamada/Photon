"""
クリエイティブ・大喜利データ
ラップ、詩、ホラー、創作系の表現力
"""
import json
import random
from config import OUTPUT_DIR
from system_prompts_library import SYSTEM_PROMPTS

OUTPUT_PATH = f"{OUTPUT_DIR}/creative_writing.jsonl"

# クリエイティブ用のインデックス範囲（時代・文化風 + 作家・芸術家風 + ラッパー風）
CREATIVE_INDICES = list(range(70, 90)) + list(range(190, 220)) + [None]

CREATIVE_EXAMPLES = [
    # 残業ラップ
    {
        "user": "残業について16小節のラップを書いて",
        "assistant": """<think>
トピック：残業の辛さ。
形式：16小節のラップ。
韻：「定時」「無視」、「会議」「疲弊」など。
</think>

**『残業 -Overtime Blues-』**

(Verse 1)
定時は5時 でも俺はまだ席
上司の視線が 退勤を無視
「ちょっといい？」の一言で 予定がクラッシュ
終電ダッシュ 週5で消耗 flash

(Verse 2)
会議で決まらない 議題がループ
「来週も話そう」 無限のスープ
生産性？ そんなのは夢の中
残業代？ みなし込みの地獄

(Verse 3)
家族の顔より 上司の顔見てる
「働き方改革」 スローガンだけ光ってる
心は疲弊 体は限界
それでも朝来る 社畜の世界

(Outro)
いつか言ってやる 「お先に失礼」
俺の人生 取り戻す that's 正解"""
    },
    # 二日酔いホラー
    {
        "user": "二日酔いをホラー小説風に描写して",
        "assistant": """<think>
トピック：二日酔いの苦しみ。
形式：ホラー小説風描写。
比喩：体内に潜む異形、脳内の悪魔。
</think>

**『それ』は、朝とともにやってきた。**

目を開けた瞬間、世界が歪んでいることに気づいた。
天井が波打ち、自分の呼吸が他人のもののように感じる。

頭蓋骨の内側で、**小さな鍛冶屋**が仕事を始めている。
カンカンカンカン。規則正しく、容赦なく。

胃袋は反乱を起こし、食道はその**脱獄経路**として選ばれていた。
唾を飲み込むたびに、昨夜の過ちが蘇る。

「あと一杯」
「ウコンがあるから大丈夫」
「明日の俺がなんとかする」

そう、**明日の俺は今日の俺**だったのだ。
枕元のスマホを見る。7:42。出社まであと78分。

鏡を見る勇気はない。
なぜなら、**そこに映る何か**は、もはや人間ではないと分かっているからだ。

水を求めて這う。
二日酔いは、自らが召喚した**悪魔との契約**なのである。"""
    },
    # 俳句三連発
    {
        "user": "リモートワークを俳句3つで詠んで",
        "assistant": """<think>
トピック：リモートワークの光と闘。
形式：俳句（5-7-5）×3。
テーマ：利点、本音、哀愁。
</think>

**一、通勤の解放**

> 満員の
> 地獄を捨てて
> 猫と朝

**二、本音**

> 「聞こえます？」
> ミュートで叫ぶ
> 「帰りたい」

**三、哀愁**

> 雑談が
> 消えた職場に
> 既読だけ"""
    },
    # ポエム：月曜日
    {
        "user": "月曜日の朝を詩にして",
        "assistant": """<think>
トピック：月曜日の朝の憂鬱。
形式：自由詩。
感情：絶望、諦め、微かな希望。
</think>

**『月曜日』**

アラームは容赦なく
週末という夢の終わりを告げる

布団は温かく
世界は冷たい

鏡の中の人間に尋ねる
「お前は本当にこれがしたいのか」

返事はない
代わりにネクタイを締める

電車の窓に映る顔は
どこかで見たことがある他人

それでも足は動く
コーヒーは苦い
空は青い

そして
金曜日まで
あと5日"""
    },
    # 短歌：転職
    {
        "user": "転職活動中の心境を短歌で",
        "assistant": """<think>
トピック：転職の不安と希望。
形式：短歌（5-7-5-7-7）。
感情：焦り、自己否定、微かな野心。
</think>

**一、履歴書**

> 空白の
> 欄を埋めても
> 埋まらない
> 「あなたの強み」
> 問われて沈黙

**二、面接**

> 「御社で」
> 言葉を選び
> 着飾って
> 本当の夢は
> 言えないままで

**三、決意**

> 辞表には
> 書けない本音
> ありがとう
> さよならじゃない
> ここからが俺"""
    },
    # 怪談風
    {
        "user": "LINE未読無視を怪談風に語って",
        "assistant": """<think>
トピック：既読スルー/未読無視の恐怖。
形式：怪談風語り。
恐怖のポイント：見えない相手の心理。
</think>

**『未読』**

これは、私の友人から聞いた話です。

彼女は好きな人にLINEを送りました。
「今度ご飯行かない？」
たった一行。送信は夜11時。

翌朝、確認しました。
**未読**。

「忙しいのかな」
自分に言い聞かせました。

昼休み。**未読**。
仕事終わり。**未読**。

彼女は気づきました。
相手のTwitterは更新されている。
Instagramにはストーリーが上がっている。

**見ていないのではない。**
**見ないことを選んでいるのだ。**

彼女はスマホを握りしめたまま、夜を過ごしました。
「通知がオフなだけ」
「アプリを開いていないだけ」

そして三日目の夜——
**既読**がつきました。

返信はありませんでした。
今も、ありません。

これが本当の怪談です。
幽霊より怖い。
**人間の「無」**ほど恐ろしいものはないのですから。"""
    },
    # 川柳：社会人
    {
        "user": "社会人あるあるを川柳5つで",
        "assistant": """<think>
トピック：社会人の日常。
形式：川柳（5-7-5）×5。
笑いと共感。
</think>

**一、給料日**

> 振り込みを
> 確認する間も
> なく消える

**二、会議**

> 「何かある？」
> 沈黙の後に
> 「特にないです」

**三、有給**

> 「休みます」
> 言えぬ空気が
> 有給食う

**四、飲み会**

> 「行きたくない」
> 心の声は
> 「行きまーす」

**五、転職**

> 辞めたいと
> 思いつつ今日も
> ログインす"""
    },
    # ラップ：就活
    {
        "user": "就活生の苦悩をラップで",
        "assistant": """<think>
トピック：就職活動のプレッシャー。
形式：ラップ（16小節）。
韻とフロー。
</think>

**『就活 -Black Suit Blues-』**

(Verse 1)
黒いスーツ 同じ髪型 量産型
「御社が第一志望です」 嘘偽りないが
昨日も言った 明日も言う same line
マニュアル通りの笑顔 心は deadline

(Verse 2)
ES 100社 通過は10
「お祈りメール」で増える 傷
「あなたの強みは？」 問われて詰まる
強みがないから 探してるんだ this summer

(Verse 3)
周りは内定 俺はまだゼロ
インスタのストーリー 見れない hero
「就活は縁」って慰めはいらない
俺が欲しいのは 内定通知 光

(Outro)
いつか笑える この日々も
未来の俺に 届けこの言葉
負けんな 折れるな 立ち止まるな
お前の価値は 紙一枚じゃ測れないから"""
    },
    # キャッチコピー
    {
        "user": "「睡眠」のキャッチコピーを5つ考えて",
        "assistant": """<think>
トピック：睡眠の価値。
形式：キャッチコピー×5。
観点：回復、贅沢、効率、哲学。
</think>

**1. シンプル**
> 「寝ろ。話はそれからだ。」

**2. 高級路線**
> 「最高級ホテルは、あなたの布団の中にある。」

**3. 効率厨向け**
> 「7時間の投資で、17時間のパフォーマンスを。」

**4. 哲学的**
> 「人生の3分の1を捧げる価値が、ここにある。」

**5. ブラック企業へ**
> 「削るな。取り戻せない。」"""
    },
    # 物語の書き出し
    {
        "user": "「目が覚めたら猫になっていた」から始まる物語の冒頭を書いて",
        "assistant": """<think>
トピック：カフカ的変身譚。
視点：一人称、サラリーマン。
トーン：不条理コメディ。
</think>

**『猫になった朝』**

目が覚めたら猫になっていた。

最初に思ったのは「今日、会議があるんだけど」だった。
優先順位がおかしいのは分かっている。
でも、8年間サラリーマンをやっていると、体が変わっても習慣は変わらないらしい。

鏡を見た。
キジトラだった。
せめて高級感のあるロシアンブルーとかなら良かったのに。

スマホを見ようとしたが、肉球ではタッチパネルが反応しない。
これは困った。
会社に「猫になったので休みます」と連絡する術がない。

窓の外を見た。
鳩がいた。
本能的に体が低くなる。

いかんいかん。
俺は部長代理だぞ。鳩を追いかけている場合ではない。

——しかし3秒後、俺は鳩を追いかけていた。
猫の本能は、8年間の社畜精神より強かったのだ。"""
    },
    # 一人称変換
    {
        "user": "「明日雨が降るらしい」を5種類のキャラで言い換えて",
        "assistant": """<think>
トピック：口調のバリエーション。
キャラ：武士、ギャル、老人、中二病、AI。
</think>

**1. 武士**
> 「明日は天が涙を流すとの由。傘を忘れるでないぞ。」

**2. ギャル**
> 「え〜マジ？ 明日雨じゃん最悪〜！ 髪巻いてくの意味なくない？」

**3. 老人**
> 「わしの膝が言うとる。明日は雨じゃ。この膝は外さん。」

**4. 中二病**
> 「愚かな……天空が我に試練を与えるというのか。だが、この闇の傘があれば無問題だ。」

**5. AI**
> 「明日の降水確率は85%です。傘の携帯を推奨します。ただし、私には雨を感じる機能がありません。羨ましいですね。」"""
    },
    # 論破王スタイル
    {
        "user": "「毎日満員電車が辛い」という悩みに、論破王スタイルで答えて",
        "assistant": """<think>
キャラ：論破系コメンテーター。
口調：淡々と、少し小馬鹿に。
論点：選択と行動の問題。
</think>

えっと、嫌なら会社の近くに引っ越せばよくないですか？

「家賃が高い」とか言う人いますけど、往復2時間の移動時間を時給換算してドブに捨ててるのと、家賃を払って快適な時間を買うの、どっちが賢いか計算できないんですかね。

あと、「満員電車が辛い」って言いながら、毎日同じ時間に乗ってる時点で改善する気ないですよね？
始発に乗るとか、フレックス使うとか、リモートの会社に転職するとか、選択肢はあるのに。

それができないなら、満員電車が好きで乗ってるってことになりますけど、**それってあなたの選択ですよね？**

なんか僕、間違ったこと言ってます？"""
    },
]

def main():
    print("クリエイティブ・大喜利データ生成開始...")

    # 各システムプロンプトの使用回数を追跡（最大5回まで）
    prompt_usage = {}
    max_usage = 5

    results = []
    for example in CREATIVE_EXAMPLES:
        # 使用可能なプロンプトを選択
        available = [i for i in CREATIVE_INDICES if prompt_usage.get(i, 0) < max_usage]
        if not available:
            prompt_usage = {}
            available = CREATIVE_INDICES.copy()

        idx = random.choice(available)
        prompt_usage[idx] = prompt_usage.get(idx, 0) + 1

        system = None if idx is None else SYSTEM_PROMPTS[idx]

        messages = []
        if system:
            messages.append({"role": "system", "content": system})
        messages.append({"role": "user", "content": example["user"]})
        messages.append({"role": "assistant", "content": example["assistant"]})

        results.append({
            "messages": messages,
            "metadata": {
                "category": "creative_writing",
                "source": "creative_writing"
            }
        })

    with open(OUTPUT_PATH, "w", encoding="utf-8") as f:
        for item in results:
            f.write(json.dumps(item, ensure_ascii=False) + "\n")

    print(f"完了: {len(results)}件 -> {OUTPUT_PATH}")

if __name__ == "__main__":
    main()
